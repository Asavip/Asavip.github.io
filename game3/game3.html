<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เกมการคูณอย่างง่าย</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .container {
            max-width: 600px;
            min-height: 400px;
            background-color: white;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease-in-out;
        }
        .answer-button {
            font-size: 3rem;
            padding-top: 2rem;
            padding-bottom: 2rem;
            padding-left: 3rem;
            padding-right: 3rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="main-container" class="container w-full">
        <!-- หน้าแรก -->
        <div id="home-page" class="text-center transition-opacity duration-500 ease-in-out">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-8">เกมการคูณอย่างง่าย</h1>
            <p class="text-lg text-gray-600 mb-6">เลือกชุดเกมที่คุณต้องการเล่น</p>
            <div class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                <select id="set-selector" class="p-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 text-gray-700 w-full sm:w-auto">
                    <!-- Options will be generated by JavaScript -->
                </select>
                <button onclick="startGame()" class="bg-indigo-600 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:bg-indigo-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 w-full sm:w-auto">
                    เริ่มเล่นเกม
                </button>
            </div>
        </div>

        <!-- หน้าเกม -->
        <div id="game-page" class="hidden text-center transition-opacity duration-500 ease-in-out">
            <div class="flex items-center justify-between mb-4 w-full">
                <select id="game-selector-top" onchange="changeGameSet()" class="p-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 text-gray-700 text-sm">
                    <!-- Options will be generated by JavaScript -->
                </select>
                <div class="text-gray-500 font-semibold text-sm">
                    ชุดที่: <span id="current-set"></span> | ข้อที่: <span id="current-question-number"></span> / 20
                </div>
            </div>
            <h2 id="question-text" class="text-5xl font-extrabold text-gray-800 mb-12"></h2>
            <div id="answers-container" class="flex flex-col space-y-4 mb-8">
                <!-- ปุ่มคำตอบจะถูกสร้างด้วย JavaScript -->
            </div>
            <div class="flex justify-between items-center text-gray-600 text-lg font-semibold mt-8">
                <div>คะแนน: <span id="score-display">0</span></div>
                <div>เวลา: <span id="timer-display">00:00</span></div>
            </div>
        </div>

        <!-- หน้าเฉลย -->
        <div id="feedback-page" class="hidden text-center transition-opacity duration-500 ease-in-out">
            <div id="feedback-content" class="flex items-center justify-center h-48">
                <!-- เฉลยคำตอบจะแสดงที่นี่ -->
            </div>
        </div>

        <!-- หน้าสรุปผล -->
        <div id="summary-page" class="hidden text-center transition-opacity duration-500 ease-in-out">
            <h2 class="text-4xl font-extrabold text-gray-900 mb-4">สรุปผลคะแนน</h2>
            <p id="score-text" class="text-6xl font-extrabold mb-8"></p>
            <p id="questions-answered-text" class="text-lg text-gray-600 mb-8"></p>
            <p id="time-text" class="text-lg text-gray-600 mb-8"></p>
            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                <button onclick="returnToHome()" class="bg-indigo-600 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:bg-indigo-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 w-full sm:w-auto">
                    เลือกชุดใหม่
                </button>
                <button onclick="returnToMainPage()" class="bg-gray-300 text-gray-800 font-semibold py-3 px-8 rounded-xl shadow-lg hover:bg-gray-400 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 w-full sm:w-auto">
                    กลับไปยังหน้าหลัก
                </button>
            </div>
        </div>
    </div>

    <script>
        // Web Audio API for sound effects
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // Function to generate a simple tone
        function playTone(frequency, duration, volume) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.value = frequency;
            
            gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.start();
            
            // Fade out the tone to prevent clicks
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + duration / 1000);
            
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        // Play correct answer sound (two doorbells)
        function playCorrectSound() {
            playTone(660, 150, 0.5); // First part of doorbell (e.g., 'ding')
            setTimeout(() => {
                playTone(880, 200, 0.5); // Second part of doorbell (e.g., 'dong')
            }, 200);
        }

        // Play incorrect answer sound (a short buzz)
        function playIncorrectSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.type = 'triangle'; 
            oscillator.frequency.setValueAtTime(500, audioContext.currentTime); 
            oscillator.frequency.linearRampToValueAtTime(200, audioContext.currentTime + 0.3);

            gainNode.gain.setValueAtTime(0.8, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.3);

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }
        
        // Data for sets and questions will be generated dynamically
        let currentQuestions = [];
        let currentSetNumber = 1;
        let currentQuestionIndex = 0;
        let correctAnswers = 0;
        let isAnswered = false;
        let timerInterval;
        let elapsedTime = 0;

        const homePage = document.getElementById('home-page');
        const gamePage = document.getElementById('game-page');
        const feedbackPage = document.getElementById('feedback-page');
        const summaryPage = document.getElementById('summary-page');
        const setSelector = document.getElementById('set-selector');
        const setSelectorTop = document.getElementById('game-selector-top');
        const questionText = document.getElementById('question-text');
        const answersContainer = document.getElementById('answers-container');
        const feedbackContent = document.getElementById('feedback-content');
        const currentSetSpan = document.getElementById('current-set');
        const currentQuestionNumberSpan = document.getElementById('current-question-number');
        const scoreText = document.getElementById('score-text');
        const questionsAnsweredText = document.getElementById('questions-answered-text');
        const timeText = document.getElementById('time-text');
        const scoreDisplay = document.getElementById('score-display');
        const timerDisplay = document.getElementById('timer-display');

        // Generate options for the set selectors (7 sets)
        for (let i = 1; i <= 7; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = `ชุดที่ ${i}`;
            setSelector.appendChild(option);
            
            const optionTop = option.cloneNode(true);
            setSelectorTop.appendChild(optionTop);
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to generate 20 multiplication questions from random tables 2-12
        function generateMultiplicationQuestions() {
            const questions = [];
            for (let i = 0; i < 20; i++) {
                const a = Math.floor(Math.random() * 11) + 2; // Random number from 2 to 12
                const b = Math.floor(Math.random() * 12) + 1; // Random number from 1 to 12
                const answer = a * b;
                
                const options = [];
                options.push(answer);
                
                // Add two incorrect but plausible options
                let wrong1 = answer + Math.floor(Math.random() * 5) + 1;
                while (options.includes(wrong1)) {
                    wrong1 = answer + Math.floor(Math.random() * 5) + 1;
                }
                options.push(wrong1);

                let wrong2 = answer - Math.floor(Math.random() * 5) - 1;
                while (wrong2 < 0 || options.includes(wrong2)) {
                    wrong2 = answer - Math.floor(Math.random() * 5) - 1;
                }
                options.push(wrong2);

                // Shuffle the options
                options.sort(() => Math.random() - 0.5);

                questions.push({
                    question: `${a} x ${b}`,
                    options: options,
                    answer: answer
                });
            }
            return questions;
        }

        // Start game function
        function startGame() {
            currentSetNumber = parseInt(setSelector.value);
            currentQuestions = generateMultiplicationQuestions();
            currentQuestionIndex = 0;
            correctAnswers = 0;
            elapsedTime = 0;
            
            setSelectorTop.value = currentSetNumber;
            summaryPage.classList.add('hidden');

            homePage.classList.add('hidden');
            gamePage.classList.remove('hidden');
            gamePage.style.opacity = '0';
            setTimeout(() => {
                gamePage.style.opacity = '1';
            }, 10);
            
            startTimer();
            loadQuestion();
        }

        // Change game set from the dropdown on the game page
        function changeGameSet() {
            currentSetNumber = parseInt(setSelectorTop.value);
            currentQuestions = generateMultiplicationQuestions();
            currentQuestionIndex = 0;
            correctAnswers = 0;
            elapsedTime = 0;
            
            clearInterval(timerInterval);
            startTimer();
            loadQuestion();
        }

        // Start the timer
        function startTimer() {
            timerInterval = setInterval(() => {
                elapsedTime++;
                const minutes = Math.floor(elapsedTime / 60).toString().padStart(2, '0');
                const seconds = (elapsedTime % 60).toString().padStart(2, '0');
                timerDisplay.textContent = `${minutes}:${seconds}`;
            }, 1000);
        }

        // Load a new question
        function loadQuestion() {
            isAnswered = false;
            feedbackPage.classList.add('hidden');
            gamePage.classList.remove('hidden');
            feedbackPage.classList.remove('bg-green-600', 'bg-red-600');
            
            scoreDisplay.textContent = correctAnswers;

            if (currentQuestionIndex < currentQuestions.length) {
                const q = currentQuestions[currentQuestionIndex];
                questionText.textContent = q.question;
                currentQuestionNumberSpan.textContent = currentQuestionIndex + 1;
                currentSetSpan.textContent = currentSetNumber;
                answersContainer.innerHTML = '';

                // Create answer buttons
                q.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.classList.add('bg-blue-600', 'text-white', 'font-semibold', 'rounded-xl', 'shadow-sm', 'hover:bg-blue-700', 'transition-colors', 'duration-200', 'focus:outline-none', 'w-full', 'answer-button');
                    button.onclick = () => checkAnswer(option);
                    answersContainer.appendChild(button);
                });
            } else {
                showSummary();
            }
        }

        // Check the selected answer
        function checkAnswer(selectedOption) {
            if (isAnswered) return;
            isAnswered = true;

            const q = currentQuestions[currentQuestionIndex];
            const buttons = answersContainer.querySelectorAll('button');

            buttons.forEach(button => {
                button.disabled = true;
            });
            
            gamePage.classList.add('hidden');
            feedbackPage.classList.remove('hidden');

            if (selectedOption === q.answer) {
                // Correct answer logic
                correctAnswers++;
                feedbackPage.classList.add('bg-green-600');
                playCorrectSound();
                feedbackContent.innerHTML = `<p class="text-4xl font-bold text-white">ถูกต้อง!!</p>`;
                setTimeout(() => {
                    currentQuestionIndex++;
                    loadQuestion();
                }, 2000); // 2 second delay for feedback
            } else {
                // Incorrect answer logic
                feedbackPage.classList.add('bg-red-600');
                playIncorrectSound();
                feedbackContent.innerHTML = `<p class="text-4xl font-bold text-white">คำตอบที่ถูกต้องคือ: <span class="text-white">${q.answer}</span></p>`;
                setTimeout(() => {
                    currentQuestionIndex++;
                    loadQuestion();
                }, 3000); // 3 second delay for feedback
            }
        }

        // End game screen and show score
        function showSummary() {
            clearInterval(timerInterval);
            gamePage.classList.add('hidden');
            summaryPage.classList.remove('hidden');
            summaryPage.style.opacity = '0';
            setTimeout(() => {
                summaryPage.style.opacity = '1';
            }, 10);
            
            scoreText.textContent = `${correctAnswers}`;
            questionsAnsweredText.textContent = `คะแนนที่ได้ ${correctAnswers} จาก 20 ข้อ`;
            const minutes = Math.floor(elapsedTime / 60).toString().padStart(2, '0');
            const seconds = (elapsedTime % 60).toString().padStart(2, '0');
            timeText.textContent = `ใช้เวลาไป ${minutes} นาที ${seconds} วินาที`;
        }
        
        // Return to home page (reload current page to reset game)
        function returnToHome() {
            summaryPage.classList.add('hidden');
            homePage.classList.remove('hidden');
        }

        // Return to main page (external link)
        function returnToMainPage() {
            window.location.href = 'index.html';
        }

        // Initial setup for the first run
        window.onload = function() {
            setSelector.selectedIndex = 0; // Select the first set by default
        };
    </script>
</body>
</html>
